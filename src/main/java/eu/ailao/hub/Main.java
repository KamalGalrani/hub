package eu.ailao.hub;

import eu.ailao.hub.communication.WebInterface;
import eu.ailao.hub.hereapi.StreetTrafficInfo;
import eu.ailao.hub.hereapi.TrafficConnector;
import org.json.JSONArray;
import org.json.JSONObject;

/**
 * Created by Petr Marek on 26.11.2015.
 */
public class Main {

	public static void main(String[] args) {
		//Just for testing purposes, it will be deleted
		boolean TESTING = true;
		if (TESTING) {
			Main main = new Main();
			main.testingFunction();
		}

		if (args.length < 2) {
			System.err.println("Insert port and yodaQA url as arguments please.");
			System.exit(-1);
		}
		int port = Integer.parseInt(args[0]);
		String yodaQAURL = args[1];
		WebInterface web = new WebInterface(port, yodaQAURL);
		Thread webThread = new Thread(web);
		webThread.start();
	}

	/**
	 * THIS FUNCTION WILL BE DELETED
	 * Testing function to try, how to get information from HERE api about traffic flow in some street
	 */
	private void testingFunction(){
		String streetName = "Evropská";
		TrafficConnector trafficConnector = new TrafficConnector();

		//JSONObject streetPosition = trafficConnector.GETRequest("https://geocoder.cit.api.here.com/6.2/geocode.json?searchtext=" + streetName + "%2C%20Prague&app_id=m0gORGqDQz7BRg7MUiC3&app_code=GgpH8vtSsoG0h7rh_a9mnA&gen=8");

		//BoundingBox boundingBox = trafficConnector.getStreetBoundingBox(streetPosition);

		//JSONObject trafficFlow = trafficConnector.GETRequest("https://traffic.cit.api.here.com/traffic/6.1/flow.json?app_id=m0gORGqDQz7BRg7MUiC3&app_code=GgpH8vtSsoG0h7rh_a9mnA&bbox=" + boundingBox.getTopLeftLatitude() + "," + boundingBox.getTopLeftLongitude() + ";" + boundingBox.getBottomRightLatitude() + "," + boundingBox.getBottomRightLongitude());

		JSONObject trafficFlow = new JSONObject("{\"MAP_VERSION\":\"\",\"VERSION\":\"3.1\",\"CREATED_TIMESTAMP\":\"2016-03-14T13:17:03.000+0000\",\"UNITS\":\"metric\",\"RWS\":[{\"EXTENDED_COUNTRY_CODE\":\"E2\",\"EBU_COUNTRY_CODE\":\"2\",\"RW\":[{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":40,\"SU\":37.31,\"TY\":\"TR\",\"CN\":0.84,\"JF\":0.98526,\"SP\":37.31}],\"TMC\":{\"DE\":\"R1 Ruzynì\",\"PC\":4490,\"QD\":\"+\",\"LE\":0.43201}},{\"CF\":[{\"FF\":46,\"SU\":45.36,\"TY\":\"TR\",\"CN\":0.81,\"JF\":0.20443,\"SP\":45.36}],\"TMC\":{\"DE\":\"Vlastina\",\"PC\":18056,\"QD\":\"+\",\"LE\":0.92667}}]}],\"DE\":\"Drnovská\",\"PBT\":\"2016-03-14T13:16:29Z\",\"mid\":\"bb7ea1e6-722f-45d2-9a74-6f9c97e16910|\",\"LI\":\"225-00420\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":49,\"SU\":43.86,\"TY\":\"TR\",\"CN\":0.83,\"JF\":1.53839,\"SP\":43.86}],\"TMC\":{\"DE\":\"R1 Ruzynì\",\"PC\":4490,\"QD\":\"-\",\"LE\":1.27916}}]}],\"DE\":\"Drnovská\",\"PBT\":\"2016-03-14T13:16:32Z\",\"mid\":\"d6011394-ef8b-4827-95c2-8337df58a26a|\",\"LI\":\"225+00420\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":45,\"SU\":35.84,\"TY\":\"TR\",\"CN\":0.93,\"JF\":2.98583,\"SP\":35.84}],\"TMC\":{\"DE\":\"Vokovická\",\"PC\":4451,\"QD\":\"+\",\"LE\":0.56669}},{\"CF\":[{\"FF\":57,\"SU\":52.13,\"TY\":\"TR\",\"CN\":0.91,\"JF\":1.25192,\"SP\":52.13}],\"TMC\":{\"DE\":\"José Martího\",\"PC\":10097,\"QD\":\"+\",\"LE\":0.75826}},{\"CF\":[{\"FF\":53,\"SU\":36.86,\"TY\":\"TR\",\"CN\":0.9,\"JF\":4.45844,\"SP\":36.86}],\"TMC\":{\"DE\":\"Libocká\",\"PC\":10096,\"QD\":\"+\",\"LE\":0.94507}},{\"CF\":[{\"FF\":46,\"SU\":39.12,\"TY\":\"TR\",\"CN\":0.92,\"JF\":2.19383,\"SP\":39.12}],\"TMC\":{\"DE\":\"Vlastina\",\"PC\":18057,\"QD\":\"+\",\"LE\":0.2086}},{\"CF\":[{\"FF\":58,\"SU\":53.81,\"TY\":\"TR\",\"CN\":0.93,\"JF\":1.06015,\"SP\":53.81}],\"TMC\":{\"DE\":\"R1 Ruzynì\",\"PC\":4450,\"QD\":\"+\",\"LE\":1.81803}}]}],\"DE\":\"Evropská\",\"PBT\":\"2016-03-14T13:16:37Z\",\"mid\":\"f9a5db79-8ad3-4567-be83-bfd790e73326|\",\"LI\":\"225-00496\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":37,\"SU\":35.73,\"TY\":\"TR\",\"CN\":0.89,\"JF\":0.50427,\"SP\":35.73}],\"TMC\":{\"DE\":\"R1 Ruzynì\",\"PC\":4450,\"QD\":\"-\",\"LE\":0.18143}},{\"CF\":[{\"FF\":59,\"SU\":49.58,\"TY\":\"TR\",\"CN\":0.89,\"JF\":2.34272,\"SP\":49.58}],\"TMC\":{\"DE\":\"Vlastina\",\"PC\":18057,\"QD\":\"-\",\"LE\":1.66407}},{\"CF\":[{\"FF\":40,\"SU\":33.43,\"TY\":\"TR\",\"CN\":0.87,\"JF\":2.41078,\"SP\":33.43}],\"TMC\":{\"DE\":\"Libocká\",\"PC\":10096,\"QD\":\"-\",\"LE\":0.21575}},{\"CF\":[{\"FF\":54,\"SU\":45.59,\"TY\":\"TR\",\"CN\":0.91,\"JF\":2.28332,\"SP\":45.59}],\"TMC\":{\"DE\":\"José Martího\",\"PC\":10097,\"QD\":\"-\",\"LE\":0.94018}},{\"CF\":[{\"FF\":58,\"SSS\":{\"SS\":[{\"FF\":59.87,\"SU\":43.02,\"LE\":0.21167,\"JF\":4.12587,\"SP\":43.02},{\"FF\":59.36,\"SU\":47.26,\"LE\":0.54922,\"JF\":2.99081,\"SP\":47.26}]},\"SU\":49.19,\"TY\":\"TR\",\"CN\":0.92,\"JF\":2.22859,\"SP\":49.19}],\"TMC\":{\"DE\":\"Vokovická\",\"PC\":4451,\"QD\":\"-\",\"LE\":0.7609}},{\"CF\":[{\"FF\":46,\"SU\":35.1,\"TY\":\"TR\",\"CN\":0.91,\"JF\":3.47541,\"SP\":35.1}],\"TMC\":{\"DE\":\"Etiopská\",\"PC\":10098,\"QD\":\"-\",\"LE\":0.56339}}]}],\"DE\":\"Evropská\",\"PBT\":\"2016-03-14T13:16:59Z\",\"mid\":\"4f7f93e8-dc4b-4b4f-9c12-b0529c9ce003|\",\"LI\":\"225+00496\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":65,\"SU\":60.59,\"TY\":\"TR\",\"CN\":0.95,\"JF\":0.99458,\"SP\":60.59}],\"TMC\":{\"DE\":\"Pražský okruh\",\"PC\":24828,\"QD\":\"+\",\"LE\":1.26213}}]}],\"DE\":\"Lipská\",\"PBT\":\"2016-03-14T13:16:06Z\",\"mid\":\"c93220d0-3f1b-4141-9fe1-5ec969b60d5f|\",\"LI\":\"225-09040\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":50,\"SU\":46.24,\"TY\":\"TR\",\"CN\":0.94,\"JF\":1.10174,\"SP\":46.24}],\"TMC\":{\"DE\":\"Pražský okruh\",\"PC\":24828,\"QD\":\"-\",\"LE\":0.04219}},{\"CF\":[{\"FF\":81,\"SU\":77.78,\"TY\":\"TR\",\"CN\":0.95,\"JF\":0.58354,\"SP\":77.78}],\"TMC\":{\"DE\":\"R7 Letištì\",\"PC\":10182,\"QD\":\"-\",\"LE\":1.37351}}]}],\"DE\":\"Lipská\",\"PBT\":\"2016-03-14T13:16:28Z\",\"mid\":\"d9a89c97-aebc-4e96-af87-bd36edba82ab|\",\"LI\":\"225+09040\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":28,\"SU\":18.72,\"TY\":\"TR\",\"CN\":0.89,\"JF\":4.8495,\"SP\":18.72}],\"TMC\":{\"DE\":\"Evropská\",\"PC\":18052,\"QD\":\"-\",\"LE\":0.27485}}]}],\"DE\":\"Libocká\",\"PBT\":\"2016-03-14T13:17:03Z\",\"mid\":\"4b6d40df-7ba1-40b8-a009-03487a4d0a67|\",\"LI\":\"225+09898\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":29,\"SU\":14.34,\"TY\":\"TR\",\"CN\":0.82,\"JF\":7.36621,\"SP\":14.34}],\"TMC\":{\"DE\":\"Evropská\",\"PC\":18052,\"QD\":\"+\",\"LE\":0.0123}},{\"CF\":[{\"FF\":36,\"SU\":27.79,\"TY\":\"TR\",\"CN\":0.73,\"JF\":3.34357,\"SP\":27.79}],\"TMC\":{\"DE\":\"U Silnice\",\"PC\":18058,\"QD\":\"+\",\"LE\":0.26254}}]}],\"DE\":\"Libocká\",\"PBT\":\"2016-03-14T13:17:03Z\",\"mid\":\"0be41e1b-35f9-47e5-b750-14d3491ffb33|\",\"LI\":\"225-09898\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":49,\"SU\":50.51,\"TY\":\"TR\",\"CN\":0.76,\"JF\":0,\"SP\":50.51}],\"TMC\":{\"DE\":\"Pražský okruh\",\"PC\":25000,\"QD\":\"+\",\"LE\":1.8531}}]}],\"DE\":\"Do Horomìøic\",\"PBT\":\"2016-03-14T13:17:03Z\",\"mid\":\"8e5aacba-b3ef-4fd2-9384-a35f9697f6d3|\",\"LI\":\"225-24999\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":34,\"SU\":41.42,\"TY\":\"TR\",\"CN\":0.9,\"JF\":0,\"SP\":41.42}],\"TMC\":{\"DE\":\"Pražský okruh\",\"PC\":25000,\"QD\":\"-\",\"LE\":0.04066}},{\"CF\":[{\"FF\":50,\"SU\":56.52,\"TY\":\"TR\",\"CN\":0.9,\"JF\":0,\"SP\":50.8}],\"TMC\":{\"DE\":\"Tuchomìøická\",\"PC\":25001,\"QD\":\"-\",\"LE\":1.81332}}]}],\"DE\":\"Do Horomìøic\",\"PBT\":\"2016-03-14T13:17:03Z\",\"mid\":\"de76edbb-34ce-4bfe-8bf1-6f55c5674005|\",\"LI\":\"225+24999\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":33,\"SU\":27.42,\"TY\":\"TR\",\"CN\":0.92,\"JF\":2.48042,\"SP\":27.42}],\"TMC\":{\"DE\":\"R1 Ruzynì\",\"PC\":26487,\"QD\":\"+\",\"LE\":0.05488}},{\"CF\":[{\"FF\":39,\"SU\":28.96,\"TY\":\"TR\",\"CN\":0.81,\"JF\":3.77676,\"SP\":28.96}],\"TMC\":{\"DE\":\"Praha-Ruzynì\",\"PC\":26488,\"QD\":\"+\",\"LE\":0.85959}}]}],\"DE\":\"K letišti\",\"PBT\":\"2016-03-14T13:16:14Z\",\"mid\":\"feb0fde6-065c-44ea-bb49-74efde439610|\",\"LI\":\"225-26486\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":38,\"SU\":32.85,\"TY\":\"TR\",\"CN\":0.77,\"JF\":1.9882,\"SP\":32.85}],\"TMC\":{\"DE\":\"R1 Ruzynì\",\"PC\":26487,\"QD\":\"-\",\"LE\":0.85344}}]}],\"DE\":\"K letišti\",\"PBT\":\"2016-03-14T13:16:37Z\",\"mid\":\"6e52c4fe-c0eb-4210-bdd8-10adf4d604a8|\",\"LI\":\"225+26486\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":27,\"SU\":23.08,\"TY\":\"TR\",\"CN\":0.71,\"JF\":2.131,\"SP\":23.08}],\"TMC\":{\"DE\":\"Evropská\",\"PC\":26595,\"QD\":\"+\",\"LE\":0.03729}},{\"CF\":[{\"FF\":32,\"SU\":29.25,\"TY\":\"TR\",\"CN\":0.71,\"JF\":1.26157,\"SP\":29.25}],\"TMC\":{\"DE\":\"U silnice\",\"PC\":26594,\"QD\":\"+\",\"LE\":0.37168}},{\"CF\":[{\"FF\":44,\"SU\":39.77,\"TY\":\"TR\",\"CN\":0.76,\"JF\":1.41018,\"SP\":39.77}],\"TMC\":{\"DE\":\"Drnovská\",\"PC\":26593,\"QD\":\"+\",\"LE\":0.91679}}]}],\"DE\":\"Vlastina\",\"PBT\":\"2016-03-14T13:17:03Z\",\"mid\":\"138a60a8-5f7c-4dd0-bbb9-67c688e59ffa|\",\"LI\":\"225-26592\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":45,\"SU\":39.62,\"TY\":\"TR\",\"CN\":0.82,\"JF\":1.75304,\"SP\":39.62}],\"TMC\":{\"DE\":\"U silnice\",\"PC\":26594,\"QD\":\"-\",\"LE\":0.82124}},{\"CF\":[{\"FF\":31,\"SU\":25.96,\"TY\":\"TR\",\"CN\":0.72,\"JF\":2.38312,\"SP\":25.96}],\"TMC\":{\"DE\":\"Evropská\",\"PC\":26595,\"QD\":\"-\",\"LE\":0.40898}}]}],\"DE\":\"Vlastina\",\"PBT\":\"2016-03-14T13:17:03Z\",\"mid\":\"ec5d1206-febe-45e1-9ca7-195248a20eed|\",\"LI\":\"225+26592\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":100,\"SU\":95.64,\"TY\":\"TR\",\"CN\":0.94,\"JF\":0.63925,\"SP\":95.64}],\"TMC\":{\"DE\":\"Ruzynì\",\"PC\":1249,\"QD\":\"+\",\"LE\":1.7961}},{\"CF\":[{\"FF\":74,\"SU\":71.79,\"TY\":\"TR\",\"CN\":0.95,\"JF\":0.43858,\"SP\":71.79}],\"TMC\":{\"DE\":\"odb. Horomìøice\",\"PC\":18486,\"QD\":\"+\",\"LE\":0.62922}},{\"CF\":[{\"FF\":48,\"SU\":43.33,\"TY\":\"TR\",\"CN\":0.95,\"JF\":1.42733,\"SP\":43.33}],\"TMC\":{\"DE\":\"Lipská\",\"PC\":24827,\"QD\":\"+\",\"LE\":0.18152}}]}],\"DE\":\"Pražský okruh\",\"PBT\":\"2016-03-14T13:17:04Z\",\"mid\":\"12b78c91-2b82-4719-82f9-9ec68bcc97c1|\",\"LI\":\"225-00391\"},{\"FIS\":[{\"FI\":[{\"CF\":[{\"FF\":47,\"SU\":36.09,\"TY\":\"TR\",\"CN\":0.95,\"JF\":3.40552,\"SP\":36.09}],\"TMC\":{\"DE\":\"Lipská\",\"PC\":24827,\"QD\":\"-\",\"LE\":0.02825}},{\"CF\":[{\"FF\":59,\"SU\":54.36,\"TY\":\"TR\",\"CN\":0.94,\"JF\":1.15448,\"SP\":54.36}],\"TMC\":{\"DE\":\"odb. Horomìøice\",\"PC\":18486,\"QD\":\"-\",\"LE\":0.16569}},{\"CF\":[{\"FF\":80,\"SU\":75.13,\"TY\":\"TR\",\"CN\":0.94,\"JF\":0.89342,\"SP\":75.13}],\"TMC\":{\"DE\":\"Ruzynì\",\"PC\":1249,\"QD\":\"-\",\"LE\":1.12352}},{\"CF\":[{\"FF\":101,\"SU\":103.21,\"TY\":\"TR\",\"CN\":0.97,\"JF\":0,\"SP\":103.21}],\"TMC\":{\"DE\":\"Øepy\",\"PC\":1251,\"QD\":\"-\",\"LE\":2.29196}}]}],\"DE\":\"Pražský okruh\",\"PBT\":\"2016-03-14T13:17:04Z\",\"mid\":\"b6081f1a-37ae-4a2e-ba0b-2d9c8d3e2c46|\",\"LI\":\"225+00391\"}],\"TY\":\"TMC\",\"MAP_VERSION\":\"201504\",\"TABLE_ID\":\"25\",\"UNITS\":\"metric\"}]}");

		JSONArray street = trafficConnector.getStreetsJson(trafficFlow, streetName);
		StreetTrafficInfo streetTrafficInfo = trafficConnector.getStreetTrafficInfo(street);
	}
}
